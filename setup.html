

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CountDracula Setup &mdash; CountDracula .7 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="CountDracula .7 documentation" href="index.html" />
    <link rel="next" title="countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser" href="_generated/countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser.html" />
    <link rel="prev" title="Welcome to CountDracula’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="_generated/countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser.html" title="countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to CountDracula’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">CountDracula .7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="countdracula-setup">
<h1>CountDracula Setup<a class="headerlink" href="#countdracula-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>CountDracula runs on <a class="reference external" href="http://geodjango.org/">Geodjango</a>, a GIS-based extension to
<a class="reference external" href="https://www.djangoproject.com/">Django</a>, which is a high-level python web framework.</p>
<p>To setup a CountDracula database, you should first install <a class="reference external" href="http://geodjango.org/">Geodjango</a>
The best way to do this is to follow the Geodjango <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/contrib/gis/install/#platform-specific-instructions">Platform-specific instructions</a>.</p>
<p>The following were used to develop and test CountDracula:</p>
<ul class="simple">
<li>Windows 7 64-bit</li>
<li><a class="reference external" href="http://www.postgresql.org">postgreSQL</a>, an open source object-relational database system.
<em>Tested with postgreSQL 9.0.10</em></li>
<li><a class="reference external" href="http://postgis.refractions.net">postGIS</a>, an open source add-on that &#8220;spatially enables&#8221; postgreSQL
with GIS functionality. <em>Tested with postGIS 1.5</em></li>
<li><a class="reference external" href="http://www.apache.org/">Apache</a>, the webserver.  <em>Tested with Apache 2.2</em></li>
<li><a class="reference external" href="http://www.python.org/download/releases/2.7.3/">Python 2.7.3 32-bit</a></li>
<li><a class="reference external" href="http://code.google.com/p/modwsgi/">modwsgi</a>, a Python WSGI adaptor module for Apache.  This doesn&#8217;t seem to have a version.
The following python modules are also used:<ul>
<li><a class="reference external" href="http://www.initd.org/psycopg/">psycopg</a>, an PostgreSQL adapter for Python.  <em>Tested with psycopg 2.4.5</em></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/xlrd">xlrd</a>, a python library for reading Microsoft Excel files.
<em>Tested with xlrd 0.7.1</em></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/python-memcached/">python-memcached</a> This is a memory-based caching
framework that can help with performance.  Optional. <em>Tested with python-memcached 1.48</em>.</li>
<li><a class="reference external" href="https://www.djangoproject.com/">django</a>  <em>Tested with django-1.5.1</em></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="installation-instructions">
<h2>Installation Instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>postgreSQL has a straightforward installer; it asks you to choose a password for the &#8220;database superuser&#8221; and &#8220;service account&#8221;.</li>
<li>postGIS has an installer which asks you for the password (presumably from the previous step)</li>
</ul>
<p>Depending on how your setup is, you may want to adjust the
<a class="reference external" href="http://www.postgresql.org/docs/9.0/interactive/client-authentication.html">client authentication settings</a>
on your database.  For example, if your database is setup on a publicly accessible machine, you might want to
restrict the hosts which can connect to the database to be only localhost, or only the machine from which you&#8217;ll
run theses scripts.</p>
</div>
<div class="section" id="django-geodjango-setup-for-countdracula">
<h2>Django/GeoDjango Setup for CountDracula<a class="headerlink" href="#django-geodjango-setup-for-countdracula" title="Permalink to this headline">¶</a></h2>
<p>Download the CountDracula code from <a class="reference external" href="https://github.com/sfcta/CountDracula">CountDracula on GitHub</a>.
This should be downloaded to a location that can be served by Apache, or the same local drive.
In our setup, we&#8217;ll download into <tt class="docutils literal"><span class="pre">C:\CountDracula</span></tt>.  From here forward, <tt class="docutils literal"><span class="pre">%COUNT_DRACULA_ROOT%</span></tt> refers
to the root directory of the code.</p>
<p>Update the CountDracula settings file, <tt class="docutils literal"><span class="pre">%COUNT_DRACULA_ROOT%\geodjango\geodjango\settings.py</span></tt>
You should confirm/set the following:</p>
<ul class="simple">
<li>Admins: A name and email address.  (What&#8217;s this used for?  I&#8217;m not sure...)</li>
<li>The Database information: choose the name of your countdracula database, the postgres user that
will access it, and a password for that user.</li>
<li>The <tt class="docutils literal"><span class="pre">MEDIA_ROOT</span></tt> and <tt class="docutils literal"><span class="pre">STATIC_ROOT</span></tt> directories are wher media (currently none) and static files (js, css)
files will be put.  We put them in <tt class="docutils literal"><span class="pre">%COUNT_DRACULA_ROOT%/media</span></tt> and <tt class="docutils literal"><span class="pre">%COUNT_DRACULA_ROOT%/static</span></tt>,
respectively.</li>
<li>Comment out <tt class="docutils literal"><span class="pre">CACHES</span></tt> if you don&#8217;t want to deal with <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/cache/">Memcache or Caching</a>
(or if you want to deal with it later).</li>
<li>Set the <tt class="docutils literal"><span class="pre">TIME_ZONE</span></tt> to the right time zone for you.</li>
</ul>
<p>Then run the following setup commands - we recommend doing each on by hand to start with.</p>
<div class="highlight-bat"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">goto</span> <span class="nl">here</span>

<span class="c">:: RUN THIS IN THE CountDracula directory</span>
<span class="c">::</span>
<span class="c">:: set PATH to have Python, psql, runtpp, geo (for libraries), git</span>
<span class="c">::</span>
<span class="k">set</span> <span class="nv">PATH</span><span class="o">=</span>C:\Python<span class="m">27</span>;C:\Python<span class="m">27</span>\Scripts;C:\OSGeo<span class="m">4</span>W\bin;C:\Program Files (x<span class="m">86</span>)\PostgreSQL\<span class="m">9</span>.<span class="m">0</span>\bin;C:\Program Files (x<span class="m">86</span>)\Citilabs\CubeVoyager;C:\Program Files (x<span class="m">86</span>)\Git\bin;C:\Windows\System<span class="m">32</span>

<span class="c">:: the following assumes &quot;postgres&quot; is the name of your postgres superuser</span>
<span class="c">::</span>
<span class="c">:: clear out what&#39;s in there already</span>
<span class="c">::</span>
psql -U postgres -c <span class="s2">&quot;drop database countdracula_geodjango&quot;</span>
<span class="k">if</span> <span class="k">ERRORLEVEL</span> <span class="m">1</span> <span class="k">goto</span> <span class="nl">done</span>

<span class="c">::</span>
<span class="c">:: create the countdracula user (if you haven&#39;t already)</span>
<span class="c">:: This should match the settings.py file</span>
<span class="c">:: </span>
<span class="c">:: This will prompt for the the password of the new user (role), followed by that of the super postgres user (postgres).</span>
<span class="c">::</span>
psql -U postgres -c <span class="s2">&quot;select * from pg_user where usename=&#39;countdracula&#39;&quot;</span> <span class="p">|</span> <span class="n">findstr</span> countdracula
<span class="c">:: ERRORLEVEL will be 0 if it already exists</span>
<span class="k">if</span> <span class="nv">%ERRORLEVEL%</span>  <span class="o">GTR</span> <span class="m">0</span> (
  createuser -SDR --username postgres -P countdracula
)

<span class="c">::</span>
<span class="c">:: create the postgis database</span>
<span class="c">:: This will prompt for the password of the super postgres user (postgres).</span>
<span class="c">::</span>

createdb --username postgres --owner<span class="o">=</span>countdracula -T template_postgis countdracula_geodjango

<span class="c">::</span>
<span class="c">:: change the user for the two tables to countdracula</span>
<span class="c">:: This will prompt for the password of the super postgres user (postgres).</span>
<span class="c">::</span>
psql -U postgres -d countdracula_geodjango -c <span class="s2">&quot;ALTER TABLE spatial_ref_sys OWNER to countdracula;&quot;</span>
psql -U postgres -d countdracula_geodjango -c <span class="s2">&quot;ALTER TABLE geometry_columns OWNER to countdracula;&quot;</span>

<span class="c">::</span>
<span class="c">:: This is just a historical note for how the project was created</span>
<span class="c">:: django-admin.py startproject geodjango</span>
<span class="k">cd</span> geodjango

<span class="c">:: This is just a historical note for how the app was created</span>
<span class="c">::python manage.py startapp countdracula</span>

<span class="c">::</span>
<span class="c">:: Verify the countdracula model is AOK</span>
<span class="c">:: This should output a bunch of SQL</span>
python manage.py sqlall countdracula

<span class="c">::</span>
<span class="c">:: Setup the database -- you&#39;ll need to setup the django superuser (not to be confused with the postgres super user</span>
<span class="c">:: or the postgres countdracula user).</span>
python manage.py syncdb

<span class="c">::</span>
<span class="c">:: Setup the static files into STATIC_ROOT</span>
<span class="c">:: This will collect all the css and javascript files into the STATIC_ROOT.</span>
python manage.py collectstatic
</pre></div>
</td></tr></table></div>
<p>Now your CountDracula instance is setup!  One last thing - you&#8217;ll need to setup Apache to serve the CountDracula web interface.</p>
</div>
<div class="section" id="apache-setup">
<h2>Apache Setup<a class="headerlink" href="#apache-setup" title="Permalink to this headline">¶</a></h2>
<p>First, install <a class="reference external" href="http://code.google.com/p/modwsgi/">modwsgi</a>, a python WSGI adapter module for Apache.  We followed
the <a class="reference external" href="http://code.google.com/p/modwsgi/wiki/InstallationOnWindows">Windows installation instructions</a>.</p>
<p>Install the following Apache configuration file into the Apache configuration directory; the installation typically includes
an <em>extra</em> subdir in the configuration directory.</p>
<p>In our Windows installation, this file is saved as <tt class="docutils literal"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\Apache</span> <span class="pre">Software</span> <span class="pre">Foundation\Apache2.2\conf\extra\httpd-countdracula.conf</span></tt>.
Note you may have to act as root or the System Administrator to edit Apache configuration.</p>
<div class="highlight-python"><pre>
SetEnv GDAL_DATA "C:\OSGeo4W\share\gdal"

Alias /robots.txt "C:\CountDracula\geodjango\static\robots.txt"
Alias /favicon.ico "C:\CountDracula\geodjango\static\favicon.ico"

# This matches MEDIA_ROOT and STATIC_ROOT in settings
Alias /media "C:\CountDracula\media"
Alias /static "C:\CountDracula\static"

&lt;Directory "C:\CountDracula\static"&gt;
Order deny,allow
Allow from all
&lt;/Directory&gt;

&lt;Directory "C:\CountDracula\media"&gt;
Order deny,allow
Allow from all
&lt;/Directory&gt;

WSGIScriptAlias /countdracula "C:\CountDracula\geodjango\geodjango.wsgi"
WSGIPythonPath "C:\CountDracula\geodjango"
# WSGIDaemonProcess countdracula threads=1

&lt;Directory "C:\CountDracula\geodjango"&gt;
&lt;Files geodjango.wsgi&gt;
Order allow,deny
Allow from all
&lt;/Files&gt;
&lt;/Directory&gt;</pre>
</div>
<p>Add a line into the main Apache configuration file to make sure this file is included.  I typically do this where other configuration files are also included:</p>
<div class="highlight-python"><pre>LoadModule wsgi_module modules/mod_wsgi.so

# CountDracula
Include conf/extra/httpd-countdracula.conf</pre>
</div>
<p>Restart Apache.  That&#8217;s it!  Hopefully everything worked out and you can now open a browser window
and navigate to <a class="reference external" href="http://[your_hostname]/countdracula/admin">http://[your_hostname]/countdracula/admin</a> for the admin interface, and <a class="reference external" href="http://[your_hostname]/countdracula/map">http://[your_hostname]/countdracula/map</a> for the
map view.</p>
<p>Now you can start to put counts in!  More on this later.</p>
<div class="highlight-bat"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">::</span>
<span class="c">:: get in place to run scripts</span>
<span class="c">::</span>
<span class="k">cd</span> ..\scripts

<span class="c">::</span>
<span class="c">:: read nodes and intersection streetnames from Cube static network</span>
<span class="c">::</span>
python insertSanFranciscoIntersectionsFromCube.py Y:\networks\Roads<span class="m">2010</span>\FREEFLOW.net

<span class="nl">:here</span>
<span class="c">::</span>
<span class="c">:: insert PeMS counts</span>
<span class="c">::</span>
python insertSanFranciscoPeMSCounts.py -v <span class="s2">&quot;Q:\Roadway Observed Data\PeMS\D4_Data_2010\pems_dist4_2010_fullyr.dat&quot;</span> -c <span class="s2">&quot;Q:\Roadway Observed Data\PeMS\D4_Data_2010\PeMS_Census&quot;</span> lisa <span class="s2">&quot;Q:\Roadway Observed Data\PeMS\PeMs_to_NetworkNodes.xls&quot;</span>

<span class="c">::</span>
<span class="c">:: insert MTC counts</span>
<span class="c">::</span>
python insertSanFranciscoMTCCounts.py lisa <span class="s2">&quot;Q:\Roadway Observed Data\MTC\all_MTC_Counts.xls&quot;</span>

<span class="c">::</span>
<span class="c">:: insert other counts</span>
<span class="c">::</span>
<span class="c">:: python insertSanFranciscoCounts.py -f &quot;Q:\Roadway Observed Data\Counts\CountDraculaCounts\CountDraculaFailed&quot; -s &quot;Q:\Roadway Observed Data\Counts\CountDraculaCounts\CountDraculaSuccess&quot; lisa &quot;Q:\Roadway Observed Data\Counts\CountDraculaCounts\CountDraculaToProcess&quot;</span>
python insertSanFranciscoCounts.py lisa <span class="s2">&quot;Q:\Roadway Observed Data\Counts\CountDraculaCounts\CountDraculaToProcess&quot;</span>

<span class="nl">:done</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>Some issues we ran into:</p>
<ul class="simple">
<li>When installing <a class="reference external" href="http://trac.osgeo.org/osgeo4w/">OSGeo4W</a>, make sure you include the libraries GDAL18, Geos, zlib, proj, openssl, libjpeg12.</li>
<li>I had some dynamic library loading errors associated with loading gdal.  I found it useful to try to load it from the command line following
<a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/gis/install/#can-t-find-gdal-library">these instructions</a> until it was successful.
For each error I encountered, I would run the OSGeo4W installer again and choose Advanced Install, and pick the libraries that appeared to
be relevant.  I also  had to rename <tt class="docutils literal"><span class="pre">C:\OSGeo4W\bin\proj.dll</span></tt> to <tt class="docutils literal"><span class="pre">C:\OSGeo4W\bin\proj_fw.dll</span></tt>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CountDracula Setup</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#installation-instructions">Installation Instructions</a></li>
<li><a class="reference internal" href="#django-geodjango-setup-for-countdracula">Django/GeoDjango Setup for CountDracula</a></li>
<li><a class="reference internal" href="#apache-setup">Apache Setup</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to CountDracula&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="_generated/countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser.html"
                        title="next chapter">countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/setup.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="_generated/countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser.html" title="countdracula.parsers.CountsWorkbookParser.CountsWorkbookParser"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to CountDracula’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">CountDracula .7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2013, SFCTA Modeling team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>